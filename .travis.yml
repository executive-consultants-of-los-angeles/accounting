---
language: python
sudo: required
services: docker
cache:
  pip: 'yes'
before_script:
  - sudo apt-get -y update; sudo apt-get -y install docker.io
  - docker network create newhart || true
  - >
      docker run -d --name postgres -h postgres postgres:alpine
  - docker network connect newhart postgres || true
script:
  - docker build -t newhart bin
  - docker run -d --name newhart -h newhart --newtwork newhart \
    --rm newhart
  - docker exec newhart python setup.py build
  - docker exec newhart python setup.py test
  - docker exec newhart python setup.py install
  - docker exec newhart pytest
  - docker exec newhart cc-test-reporter before-build
  - docker exec newhart coverage run --source='./newhart' setup.py test
  - docker exec newhart coverage xml
after_script:
  - docker exec newhart python-codacy-coverage
  - docker exec newhart cc-test-reporter after-build -t coverage.py
  - docker stop newhart
...
